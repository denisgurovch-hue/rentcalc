<!DOCTYPE html>
<html lang="ru" id="html-root">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RentCalc - –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏ –∞—Ä–µ–Ω–¥—ã | –†–∞—Å—á–µ—Ç ROI –æ–Ω–ª–∞–π–Ω</title>
    <meta name="description" content="–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏ –∞—Ä–µ–Ω–¥—ã. –†–∞—Å—Å—á–∏—Ç–∞–π—Ç–µ –≤–∞–ª–æ–≤—É—é –∏ —á–∏—Å—Ç—É—é –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å –∫–≤–∞—Ä—Ç–∏—Ä—ã –∑–∞ 30 —Å–µ–∫—É–Ω–¥. –°—Ä–∞–≤–Ω–∏–≤–∞–π—Ç–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–π.">
    <meta name="keywords" content="–∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –∞—Ä–µ–Ω–¥—ã, —Ä–∞—Å—á–µ—Ç –¥–æ—Ö–æ–¥–∞ –æ—Ç –∞—Ä–µ–Ω–¥—ã, ROI –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä, –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å –∞—Ä–µ–Ω–¥—ã, –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏">
    <meta name="theme-color" content="#10b981">
    <meta property="og:title" content="RentCalc - –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏ –∞—Ä–µ–Ω–¥—ã">
    <meta property="og:description" content="–†–∞—Å—Å—á–∏—Ç–∞–π—Ç–µ ROI –∞—Ä–µ–Ω–¥—ã –∫–≤–∞—Ä—Ç–∏—Ä—ã –∑–∞ 30 —Å–µ–∫—É–Ω–¥">
    <meta property="og:type" content="website">
    
    <!-- Favicons -->
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <link rel="shortcut icon" href="/favicon.ico" />
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <link rel="manifest" href="/site.webmanifest" />
    
    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-P7CEXK06Y1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-P7CEXK06Y1');
    </script>
    
    <!-- Vercel Analytics -->
    <script>
        window.va = window.va || function () { (window.vaq = window.vaq || []).push(arguments); };
    </script>
    <script defer src="/_vercel/insights/script.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #10b981;
            --primary-dark: #059669;
            --secondary: #6366f1;
            --accent: #f59e0b;
            --danger: #ef4444;
            --text-dark: #1f2937;
            --text-light: #6b7280;
            --bg-light: #f9fafb;
            --bg-white: #ffffff;
            --border: #e5e7eb;
            --success: #10b981;
            --warning: #f59e0b;
            --error: #ef4444;
        }

        [data-theme="dark"] {
            --text-dark: #f3f4f6;
            --text-light: #d1d5db;
            --bg-light: #1f2937;
            --bg-white: #111827;
            --border: #374151;
        }

        html {
            font-size: 16px;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, var(--bg-light) 0%, var(--bg-white) 100%);
            color: var(--text-dark);
            line-height: 1.6;
            transition: background 0.3s ease;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 40px;
            flex-wrap: wrap;
            gap: 20px;
        }

        .header-content h1 {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: 8px;
        }

        .header-content p {
            color: var(--text-light);
            font-size: 1.1rem;
        }

        .theme-toggle,
        .lang-toggle {
            background: var(--bg-white);
            border: 2px solid var(--border);
            border-radius: 50px;
            padding: 8px 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 1.2rem;
            transition: all 0.3s ease;
        }

        .theme-toggle:hover,
        .lang-toggle:hover {
            border-color: var(--primary);
            transform: scale(1.05);
        }

        .header-controls {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .lang-buttons {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .lang-button {
            background: var(--bg-white);
            border: 2px solid var(--border);
            border-radius: 50px;
            padding: 8px 16px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--text-dark);
            transition: all 0.3s ease;
            font-family: inherit;
        }

        .lang-button:hover {
            border-color: var(--primary);
            transform: scale(1.05);
        }

        .lang-button.active {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            border-color: var(--primary);
        }

        /* Mode toggle (Basic/Pro) */
        .mode-toggle {
            display: flex;
            gap: 8px;
            align-items: center;
            background: var(--bg-white);
            border: 2px solid var(--border);
            border-radius: 50px;
            padding: 4px;
        }

        .mode-button {
            background: transparent;
            border: none;
            border-radius: 50px;
            padding: 6px 16px;
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--text-light);
            transition: all 0.3s ease;
            font-family: inherit;
        }

        .mode-button:hover {
            color: var(--text-dark);
        }

        .mode-button.active {
            background: linear-gradient(135deg, var(--secondary) 0%, var(--primary) 100%);
            color: white;
        }

        /* Checkbox styling */
        .checkbox-wrapper {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
        }

        input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
            accent-color: var(--primary);
        }

        /* Pro mode sections */
        .pro-section {
            display: none;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 2px solid var(--border);
        }

        .pro-section.active {
            display: block;
        }

        /* Advanced metrics card */
        .advanced-metrics {
            margin-top: 20px;
            padding: 20px;
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.05) 0%, rgba(16, 185, 129, 0.05) 100%);
            border-radius: 12px;
            border: 2px solid var(--border);
        }

        .main-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        @media (max-width: 900px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
        }

        .card {
            background: var(--bg-white);
            border-radius: 16px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
            border: 1px solid var(--border);
            transition: all 0.3s ease;
        }

        .card:hover {
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.12);
            transform: translateY(-2px);
        }

        .card h2 {
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: var(--text-dark);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--text-dark);
            font-size: 0.95rem;
        }

        .input-wrapper {
            position: relative;
            display: flex;
            align-items: center;
        }

        input[type="number"],
        input[type="text"] {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--border);
            border-radius: 10px;
            font-size: 1rem;
            background: var(--bg-light);
            color: var(--text-dark);
            transition: all 0.3s ease;
            font-family: inherit;
        }

        input[type="number"]:focus,
        input[type="text"]:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
            background: var(--bg-white);
        }

        input.money-input {
            text-align: left;
            letter-spacing: 0.5px;
        }

        .currency {
            position: absolute;
            right: 12px;
            color: var(--text-light);
            font-weight: 600;
            pointer-events: none;
        }

        input[type="number"] {
            padding-right: 32px;
        }

        .help-icon {
            display: inline-block;
            width: 20px;
            height: 20px;
            background: var(--primary);
            color: white;
            border-radius: 50%;
            text-align: center;
            line-height: 20px;
            font-size: 0.8rem;
            font-weight: bold;
            cursor: help;
            margin-left: 8px;
            position: relative;
        }

        .tooltip {
            display: none;
            position: absolute;
            background: var(--text-dark);
            color: white;
            padding: 10px 12px;
            border-radius: 8px;
            font-size: 0.85rem;
            white-space: nowrap;
            z-index: 1000;
            bottom: 130%;
            left: 50%;
            transform: translateX(-50%);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .tooltip::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            border: 5px solid transparent;
            border-top-color: var(--text-dark);
        }

        .help-icon:hover .tooltip {
            display: block;
        }

        .buttons-group {
            display: flex;
            gap: 12px;
            margin-top: 30px;
            flex-wrap: wrap;
        }

        button {
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: inherit;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            flex: 1;
            min-width: 150px;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(16, 185, 129, 0.3);
        }

        .btn-primary:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background: var(--bg-light);
            color: var(--text-dark);
            border: 2px solid var(--border);
        }

        .btn-secondary:hover {
            border-color: var(--primary);
            color: var(--primary);
            background: rgba(16, 185, 129, 0.05);
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
            margin-top: 20px;
        }

        @media (max-width: 600px) {
            .results-grid {
                grid-template-columns: 1fr;
            }
        }

        .result-item {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.05) 0%, rgba(99, 102, 241, 0.05) 100%);
            padding: 16px;
            border-radius: 12px;
            border-left: 4px solid var(--primary);
        }

        .result-label {
            font-size: 0.85rem;
            color: var(--text-light);
            margin-bottom: 6px;
            font-weight: 500;
        }

        .result-value {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--primary);
        }

        .result-value.warning {
            color: var(--warning);
        }

        .result-value.error {
            color: var(--error);
        }

        .result-value.info {
            color: var(--secondary);
        }

        .result-value.success {
            color: var(--success);
        }

        .history-list {
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid var(--border);
            border-radius: 10px;
            background: var(--bg-light);
        }

        .history-item {
            padding: 12px 16px;
            border-bottom: 1px solid var(--border);
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .history-item:last-child {
            border-bottom: none;
        }

        .history-item:hover {
            background: rgba(16, 185, 129, 0.1);
        }

        .history-item-text {
            font-size: 0.9rem;
            color: var(--text-dark);
        }

        .history-item-value {
            font-weight: 700;
            color: var(--primary);
        }

        .history-delete {
            background: none;
            border: none;
            color: var(--error);
            cursor: pointer;
            padding: 0;
            font-size: 1.2rem;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .history-delete:hover {
            transform: scale(1.2);
        }

        .comparison-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }

        @media (max-width: 600px) {
            .comparison-grid {
                grid-template-columns: 1fr;
            }
        }

        .comparison-card {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.05) 0%, rgba(16, 185, 129, 0.05) 100%);
            padding: 16px;
            border-radius: 12px;
            border: 2px solid var(--border);
        }

        .comparison-title {
            font-weight: 700;
            margin-bottom: 12px;
            color: var(--text-dark);
        }

        .pie-chart-container {
            position: relative;
            width: 200px;
            height: 200px;
            margin: 20px auto;
        }

        .no-data {
            text-align: center;
            padding: 30px;
            color: var(--text-light);
            font-style: italic;
        }

        .alert {
            padding: 12px 16px;
            border-radius: 8px;
            margin-bottom: 16px;
            font-weight: 500;
        }

        .alert-warning {
            background: rgba(245, 158, 11, 0.1);
            color: var(--warning);
            border-left: 4px solid var(--warning);
        }

        .alert-success {
            background: rgba(16, 185, 129, 0.1);
            color: var(--success);
            border-left: 4px solid var(--success);
        }

        .footer {
            text-align: center;
            margin-top: 60px;
            padding-top: 30px;
            border-top: 1px solid var(--border);
            color: var(--text-light);
            font-size: 0.9rem;
        }

        @media (max-width: 600px) {
            .header-content h1 {
                font-size: 1.8rem;
            }

            header {
                margin-bottom: 30px;
            }

            .card {
                padding: 20px;
            }

            .main-grid {
                gap: 20px;
                margin-bottom: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="header-content">
                <h1 data-i18n="app.title">RentCalc</h1>
                <p data-i18n="app.subtitle">–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏ –∞—Ä–µ–Ω–¥—ã</p>
            </div>
            <div class="header-controls">
                <div class="mode-toggle">
                    <button class="mode-button active" id="mode-basic" onclick="toggleMode('basic')" data-i18n="mode.basic">–ë–∞–∑–æ–≤—ã–π</button>
                    <button class="mode-button" id="mode-pro" onclick="toggleMode('pro')" data-i18n="mode.pro">Pro</button>
                </div>
                <div class="lang-buttons">
                    <button class="lang-button active" id="lang-ru" onclick="changeLanguage('ru')">üá∑üá∫ –†—É—Å—Å–∫–∏–π</button>
                    <button class="lang-button" id="lang-en" onclick="changeLanguage('en')">üá¨üáß English</button>
                </div>
                <button class="theme-toggle" onclick="toggleTheme()">
                    <span id="theme-icon">üåô</span>
                </button>
            </div>
        </header>

        <div class="main-grid">
            <!-- –õ–ï–í–ê–Ø –ö–û–õ–û–ù–ö–ê: –§–û–†–ú–ê –í–í–û–î–ê -->
            <div class="card">
                <h2 data-i18n="form.title">üìä –ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Ä–∞—Å—á–µ—Ç–∞</h2>

                <div class="form-group">
                    <label>
                        <span data-i18n="form.propertyPrice">–¶–µ–Ω–∞ –ø–æ–∫—É–ø–∫–∏ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏</span>
                        <span class="help-icon">
                            ?
                            <span class="tooltip" data-i18n="form.propertyPriceTooltip">–ü–æ–ª–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –∫–≤–∞—Ä—Ç–∏—Ä—ã –ø—Ä–∏ –ø–æ–∫—É–ø–∫–µ</span>
                        </span>
                    </label>
                    <div class="input-wrapper">
                        <input type="text" id="propertyPrice" class="money-input" placeholder="1 500 000" value="1 500 000">
                        <span class="currency">‚ÇΩ</span>
                    </div>
                </div>

                <div class="form-group">
                    <label>
                        <span data-i18n="form.monthlyRent">–ï–∂–µ–º–µ—Å—è—á–Ω–∞—è –∞—Ä–µ–Ω–¥–∞</span>
                        <span class="help-icon">
                            ?
                            <span class="tooltip" data-i18n="form.monthlyRentTooltip">–°—É–º–º–∞, –∫–æ—Ç–æ—Ä—É—é –ø–æ–ª—É—á–∞–µ—à—å –æ—Ç –∞—Ä–µ–Ω–¥–∞—Ç–æ—Ä–∞</span>
                        </span>
                    </label>
                    <div class="input-wrapper">
                        <input type="text" id="monthlyRent" class="money-input" placeholder="30 000" value="30 000">
                        <span class="currency">‚ÇΩ</span>
                    </div>
                </div>

                <div class="form-group">
                    <label>
                        <span data-i18n="form.managementCost">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–¥–∞–Ω–∏–µ–º (–≤ –º–µ—Å—è—Ü)</span>
                        <span class="help-icon">
                            ?
                            <span class="tooltip" data-i18n="form.managementCostTooltip">–í–∑–Ω–æ—Å –Ω–∞ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ –¥–æ–º–∞, –ª–∏—Ñ—Ç, –æ—Ö—Ä–∞–Ω—É</span>
                        </span>
                    </label>
                    <div class="input-wrapper">
                        <input type="text" id="managementCost" class="money-input" placeholder="3 000" value="3 000">
                        <span class="currency">‚ÇΩ</span>
                    </div>
                </div>

                <div class="form-group">
                    <label>
                        <span data-i18n="form.repairCost">–†–µ–º–æ–Ω—Ç –∏ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ (–≤ –º–µ—Å—è—Ü)</span>
                        <span class="help-icon">
                            ?
                            <span class="tooltip" data-i18n="form.repairCostTooltip">–ü—Ä–æ—Ñ–∏–ª–∞–∫—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–º–æ–Ω—Ç, –∑–∞–º–µ–Ω–∞ –º–µ–±–µ–ª–∏</span>
                        </span>
                    </label>
                    <div class="input-wrapper">
                        <input type="text" id="repairCost" class="money-input" placeholder="2 000" value="2 000">
                        <span class="currency">‚ÇΩ</span>
                    </div>
                </div>

                <div class="form-group">
                    <label>
                        <span data-i18n="form.taxesCost">–ù–∞–ª–æ–≥–∏ (–≤ –º–µ—Å—è—Ü)</span>
                        <span class="help-icon">
                            ?
                            <span class="tooltip" data-i18n="form.taxesCostTooltip">–ù–î–§–õ –∏ –ø—Ä–æ—á–∏–µ –Ω–∞–ª–æ–≥–∏</span>
                        </span>
                    </label>
                    <div class="input-wrapper">
                        <input type="text" id="taxesCost" class="money-input" placeholder="1 500" value="1 500">
                        <span class="currency">‚ÇΩ</span>
                    </div>
                </div>

                <div class="form-group">
                    <label>
                        <span data-i18n="form.insuranceCost">–°—Ç—Ä–∞—Ö–æ–≤–∫–∞ (–≤ –º–µ—Å—è—Ü)</span>
                        <span class="help-icon">
                            ?
                            <span class="tooltip" data-i18n="form.insuranceCostTooltip">–°—Ç—Ä–∞—Ö–æ–≤–∫–∞ –∏–º—É—â–µ—Å—Ç–≤–∞ –æ—Ç —Ä–∏—Å–∫–æ–≤</span>
                        </span>
                    </label>
                    <div class="input-wrapper">
                        <input type="text" id="insuranceCost" class="money-input" placeholder="500" value="500">
                        <span class="currency">‚ÇΩ</span>
                    </div>
                </div>

                <div class="form-group">
                    <label>
                        <span data-i18n="form.utilitiesCost">–ö–æ–º–º—É–Ω–∞–ª—å–Ω—ã–µ —É—Å–ª—É–≥–∏ (–≤ –º–µ—Å—è—Ü)</span>
                        <span class="help-icon">
                            ?
                            <span class="tooltip" data-i18n="form.utilitiesCostTooltip">–ï—Å–ª–∏ —Ç—ã –ø–ª–∞—Ç–∏—à—å –≤–º–µ—Å—Ç–æ –∞—Ä–µ–Ω–¥–∞—Ç–æ—Ä–∞</span>
                        </span>
                    </label>
                    <div class="input-wrapper">
                        <input type="text" id="utilitiesCost" class="money-input" placeholder="0" value="0">
                        <span class="currency">‚ÇΩ</span>
                    </div>
                </div>

                <!-- PRO MODE: –ò–ø–æ—Ç–µ–∫–∞ -->
                <div class="pro-section" id="mortgage-section">
                    <h3 style="font-size: 1.2rem; margin-bottom: 16px; color: var(--secondary);" data-i18n="mortgage.title">üè¶ –ò–ø–æ—Ç–µ–∫–∞</h3>
                    
                    <div class="checkbox-wrapper">
                        <input type="checkbox" id="useMortgage" onchange="toggleMortgageFields()">
                        <label for="useMortgage" style="margin: 0; cursor: pointer;" data-i18n="mortgage.useMortgage">–ò—Å–ø–æ–ª—å–∑—É—é –∏–ø–æ—Ç–µ–∫—É</label>
                    </div>

                    <div id="mortgage-fields" style="display: none;">
                        <div class="form-group">
                            <label>
                                <span data-i18n="mortgage.downPayment">–ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω—ã–π –≤–∑–Ω–æ—Å</span>
                                <span class="help-icon">
                                    ?
                                    <span class="tooltip" data-i18n="mortgage.downPaymentTooltip">–°—É–º–º–∞ –ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–æ–≥–æ –≤–∑–Ω–æ—Å–∞ –≤ —Ä—É–±–ª—è—Ö</span>
                                </span>
                            </label>
                            <div class="input-wrapper">
                                <input type="text" id="downPayment" class="money-input" placeholder="300 000" value="300 000">
                                <span class="currency">‚ÇΩ</span>
                            </div>
                        </div>

                        <div class="form-group">
                            <label>
                                <span data-i18n="mortgage.interestRate">–ü—Ä–æ—Ü–µ–Ω—Ç–Ω–∞—è —Å—Ç–∞–≤–∫–∞, –≥–æ–¥–æ–≤–∞—è</span>
                                <span class="help-icon">
                                    ?
                                    <span class="tooltip" data-i18n="mortgage.interestRateTooltip">–ì–æ–¥–æ–≤–∞—è –ø—Ä–æ—Ü–µ–Ω—Ç–Ω–∞—è —Å—Ç–∞–≤–∫–∞ –ø–æ –∏–ø–æ—Ç–µ–∫–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, 10%)</span>
                                </span>
                            </label>
                            <div class="input-wrapper">
                                <input type="number" id="interestRate" step="0.1" placeholder="10" value="10" min="0" max="100">
                                <span class="currency">%</span>
                            </div>
                        </div>

                        <div class="form-group">
                            <label>
                                <span data-i18n="mortgage.loanTerm">–°—Ä–æ–∫ –∫—Ä–µ–¥–∏—Ç–∞</span>
                                <span class="help-icon">
                                    ?
                                    <span class="tooltip" data-i18n="mortgage.loanTermTooltip">–°—Ä–æ–∫ –∫—Ä–µ–¥–∏—Ç–∞ –≤ –≥–æ–¥–∞—Ö</span>
                                </span>
                            </label>
                            <div class="input-wrapper">
                                <input type="number" id="loanTerm" step="1" placeholder="20" value="20" min="1" max="30">
                                <span class="currency" style="right: 40px;">–ª–µ—Ç</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- PRO MODE: –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ –º–µ—Ç—Ä–∏–∫–∏ (NPV) -->
                <div class="pro-section" id="advanced-metrics-section">
                    <h3 style="font-size: 1.2rem; margin-bottom: 16px; color: var(--secondary);" data-i18n="advanced.title">üìä –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ –º–µ—Ç—Ä–∏–∫–∏</h3>
                    
                    <div class="form-group">
                        <label>
                            <span data-i18n="advanced.investmentHorizon">–ì–æ—Ä–∏–∑–æ–Ω—Ç –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–π</span>
                            <span class="help-icon">
                                ?
                                <span class="tooltip" data-i18n="advanced.investmentHorizonTooltip">–ü–µ—Ä–∏–æ–¥ –¥–ª—è —Ä–∞—Å—á—ë—Ç–∞ NPV –≤ –≥–æ–¥–∞—Ö</span>
                            </span>
                        </label>
                        <div class="input-wrapper">
                            <input type="number" id="investmentHorizon" step="1" placeholder="10" value="10" min="1" max="50">
                            <span class="currency" style="right: 40px;">–ª–µ—Ç</span>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>
                            <span data-i18n="advanced.discountRate">–°—Ç–∞–≤–∫–∞ –¥–∏—Å–∫–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</span>
                            <span class="help-icon">
                                ?
                                <span class="tooltip" data-i18n="advanced.discountRateTooltip">–°—Ç–∞–≤–∫–∞ –¥–∏—Å–∫–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è —Ä–∞—Å—á—ë—Ç–∞ NPV (–Ω–∞–ø—Ä–∏–º–µ—Ä, 10%)</span>
                            </span>
                        </label>
                        <div class="input-wrapper">
                            <input type="number" id="discountRate" step="0.1" placeholder="10" value="10" min="0" max="100">
                            <span class="currency">%</span>
                        </div>
                    </div>
                </div>

                <div class="buttons-group">
                    <button class="btn-primary" onclick="calculateOnButtonClick()" data-i18n="form.calculate">üí∞ –†–∞—Å—Å—á–∏—Ç–∞—Ç—å</button>
                    <button class="btn-secondary" onclick="clearForm()" data-i18n="form.clear">üîÑ –û—á–∏—Å—Ç–∏—Ç—å</button>
                </div>

                <p style="margin-top: 12px; font-size: 0.85rem; color: var(--text-light); text-align: center;" data-i18n="form.hint">
                    üí° –ü–æ–¥—Å–∫–∞–∑–∫–∞: –Ω–∞–∂–º–∏ Enter –∏–ª–∏ –∫–Ω–æ–ø–∫—É "–†–∞—Å—Å—á–∏—Ç–∞—Ç—å"
                </p>
            </div>

            <!-- –ü–†–ê–í–ê–Ø –ö–û–õ–û–ù–ö–ê: –†–ï–ó–£–õ–¨–¢–ê–¢–´ -->
            <div class="card">
                <h2 data-i18n="results.title">üìà –†–µ–∑—É–ª—å—Ç–∞—Ç—ã</h2>

                <div id="results-container">
                    <div class="no-data" data-i18n="results.noData">
                        –í–≤–µ–¥–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏ –Ω–∞–∂–º–∏ "–†–∞—Å—Å—á–∏—Ç–∞—Ç—å"
                    </div>
                </div>

                <!-- PRO MODE: –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã -->
                <div id="advanced-results-container" class="advanced-metrics" style="display: none;">
                    <h3 style="font-size: 1.1rem; margin-bottom: 16px; color: var(--secondary);" data-i18n="advanced.resultsTitle">üìà –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ –º–µ—Ç—Ä–∏–∫–∏</h3>
                    <div id="advanced-results-content"></div>
                </div>

                <div style="margin-top: 30px; padding-top: 20px; border-top: 1px solid var(--border);">
                    <h3 style="margin-bottom: 16px; font-size: 1.1rem;" data-i18n="history.title">üìö –ò—Å—Ç–æ—Ä–∏—è —Ä–∞—Å—á—ë—Ç–æ–≤</h3>
                    <div id="history-container" class="history-list">
                        <div class="no-data" style="padding: 16px;" data-i18n="history.noData">
                            –†–∞—Å—á—ë—Ç—ã –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- –°–†–ê–í–ù–ï–ù–ò–ï -->
        <div class="card">
            <h2 data-i18n="comparison.title">üîÄ –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤</h2>
            <div id="comparison-container">
                <div class="no-data" data-i18n="comparison.noData">
                    –°–æ—Ö—Ä–∞–Ω–∏ –º–∏–Ω–∏–º—É–º 2 —Ä–∞—Å—á—ë—Ç–∞ –∏–∑ –∏—Å—Ç–æ—Ä–∏–∏ –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
                </div>
            </div>
            <div class="buttons-group" style="margin-top: 20px;">
                <button class="btn-secondary" onclick="clearComparison()" data-i18n="comparison.clear">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ</button>
            </div>
        </div>

        <!-- –ë–õ–û–ì –°–ï–ö–¶–ò–Ø -->
        <div class="card" style="margin-top: 30px;">
            <h2 data-i18n="blog.title">üìö –ö–∞–∫ —Ä–∞—Å—Å—á–∏—Ç–∞—Ç—å –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å –∞—Ä–µ–Ω–¥—ã –∫–≤–∞—Ä—Ç–∏—Ä—ã?</h2>
            
            <div style="color: var(--text-dark); line-height: 1.8; font-size: 0.95rem;">
                <p style="margin-bottom: 16px;">
                    <strong data-i18n="blog.formulaTitle">–§–æ—Ä–º—É–ª–∞ —Ä–∞—Å—á–µ—Ç–∞ ROI –ø—Ä–∏ –∞—Ä–µ–Ω–¥–µ:</strong>
                </p>
                <p style="background: rgba(16, 185, 129, 0.1); padding: 16px; border-radius: 8px; margin-bottom: 16px; font-weight: 600; text-align: center;" data-i18n="blog.formula">
                    (–ß–∏—Å—Ç—ã–π –¥–æ—Ö–æ–¥ –≤ –≥–æ–¥ / –°—Ç–æ–∏–º–æ—Å—Ç—å –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏) √ó 100%
                </p>
                
                <p style="margin-bottom: 16px;">
                    <strong data-i18n="blog.exampleTitle">–ü—Ä–∏–º–µ—Ä —Ä–∞—Å—á–µ—Ç–∞:</strong><br>
                    <span data-i18n="blog.example"></span>
                </p>
                
                <p style="margin-bottom: 16px;">
                    <strong style="color: var(--success);" data-i18n="blog.conclusion">‚úÖ –≠—Ç–æ —Å—á–∏—Ç–∞–µ—Ç—Å—è —Ö–æ—Ä–æ—à–µ–π –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å—é!</strong> <span data-i18n="blog.average"></span>
                </p>
            </div>
        </div>

        <!-- –§–û–†–ú–ê –û–ë–†–ê–¢–ù–û–ô –°–í–Ø–ó–ò -->
        <div class="card" style="margin-top: 30px;">
            <h2 data-i18n="feedback.title">üí¨ –û–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å</h2>
            <form action="https://formsubmit.co/info@rentcalc.ru" method="POST" style="display: flex; flex-direction: column;">
                <input type="text" name="name" data-placeholder-i18n="feedback.namePlaceholder" placeholder="–í–∞—à–µ –∏–º—è" required style="margin-bottom: 1em; padding: 0.5em; font-size: 1em; border: 1px solid var(--border); border-radius: 4px; background: var(--bg-light); color: var(--text-dark);">
                <input type="email" name="email" data-placeholder-i18n="feedback.emailPlaceholder" placeholder="–í–∞—à email" required style="margin-bottom: 1em; padding: 0.5em; font-size: 1em; border: 1px solid var(--border); border-radius: 4px; background: var(--bg-light); color: var(--text-dark);">
                <textarea name="message" data-placeholder-i18n="feedback.messagePlaceholder" placeholder="–í–∞—à–µ —Å–æ–æ–±—â–µ–Ω–∏–µ" required rows="5" style="margin-bottom: 1em; padding: 0.5em; font-size: 1em; border: 1px solid var(--border); border-radius: 4px; background: var(--bg-light); color: var(--text-dark);"></textarea>
                <input type="hidden" name="_captcha" value="false">
                <button type="submit" data-i18n="feedback.submit" style="padding: 0.75em; font-size: 1em; background-color: var(--primary); color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: 600;">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
            </form>
        </div>

        <footer class="footer">
            <p data-i18n="footer.text">RentCalc ¬© 2025 | –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏ –∞—Ä–µ–Ω–¥—ã | –í—Å–µ —Ä–∞—Å—á—ë—Ç—ã –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –≤ –±—Ä–∞—É–∑–µ—Ä–µ, –¥–∞–Ω–Ω—ã–µ –Ω–µ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è</p>
        </footer>
    </div>

    <script>
        // === TRANSLATIONS ===
        const translations = {
            ru: {
                app: {
                    title: "RentCalc",
                    subtitle: "–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏ –∞—Ä–µ–Ω–¥—ã"
                },
                form: {
                    title: "üìä –ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Ä–∞—Å—á–µ—Ç–∞",
                    propertyPrice: "–¶–µ–Ω–∞ –ø–æ–∫—É–ø–∫–∏ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏",
                    propertyPriceTooltip: "–ü–æ–ª–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –∫–≤–∞—Ä—Ç–∏—Ä—ã –ø—Ä–∏ –ø–æ–∫—É–ø–∫–µ",
                    monthlyRent: "–ï–∂–µ–º–µ—Å—è—á–Ω–∞—è –∞—Ä–µ–Ω–¥–∞",
                    monthlyRentTooltip: "–°—É–º–º–∞, –∫–æ—Ç–æ—Ä—É—é –ø–æ–ª—É—á–∞–µ—à—å –æ—Ç –∞—Ä–µ–Ω–¥–∞—Ç–æ—Ä–∞",
                    managementCost: "–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–¥–∞–Ω–∏–µ–º (–≤ –º–µ—Å—è—Ü)",
                    managementCostTooltip: "–í–∑–Ω–æ—Å –Ω–∞ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ –¥–æ–º–∞, –ª–∏—Ñ—Ç, –æ—Ö—Ä–∞–Ω—É",
                    repairCost: "–†–µ–º–æ–Ω—Ç –∏ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ (–≤ –º–µ—Å—è—Ü)",
                    repairCostTooltip: "–ü—Ä–æ—Ñ–∏–ª–∞–∫—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–º–æ–Ω—Ç, –∑–∞–º–µ–Ω–∞ –º–µ–±–µ–ª–∏",
                    taxesCost: "–ù–∞–ª–æ–≥–∏ (–≤ –º–µ—Å—è—Ü)",
                    taxesCostTooltip: "–ù–î–§–õ –∏ –ø—Ä–æ—á–∏–µ –Ω–∞–ª–æ–≥–∏",
                    insuranceCost: "–°—Ç—Ä–∞—Ö–æ–≤–∫–∞ (–≤ –º–µ—Å—è—Ü)",
                    insuranceCostTooltip: "–°—Ç—Ä–∞—Ö–æ–≤–∫–∞ –∏–º—É—â–µ—Å—Ç–≤–∞ –æ—Ç —Ä–∏—Å–∫–æ–≤",
                    utilitiesCost: "–ö–æ–º–º—É–Ω–∞–ª—å–Ω—ã–µ —É—Å–ª—É–≥–∏ (–≤ –º–µ—Å—è—Ü)",
                    utilitiesCostTooltip: "–ï—Å–ª–∏ —Ç—ã –ø–ª–∞—Ç–∏—à—å –≤–º–µ—Å—Ç–æ –∞—Ä–µ–Ω–¥–∞—Ç–æ—Ä–∞",
                    calculate: "üí∞ –†–∞—Å—Å—á–∏—Ç–∞—Ç—å",
                    clear: "üîÑ –û—á–∏—Å—Ç–∏—Ç—å",
                    hint: "üí° –ü–æ–¥—Å–∫–∞–∑–∫–∞: –Ω–∞–∂–º–∏ Enter –∏–ª–∏ –∫–Ω–æ–ø–∫—É \"–†–∞—Å—Å—á–∏—Ç–∞—Ç—å\""
                },
                results: {
                    title: "üìà –†–µ–∑—É–ª—å—Ç–∞—Ç—ã",
                    noData: "–í–≤–µ–¥–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏ –Ω–∞–∂–º–∏ \"–†–∞—Å—Å—á–∏—Ç–∞—Ç—å\"",
                    success: "‚úÖ –†–∞—Å—á—ë—Ç –∑–∞–≤–µ—Ä—à—ë–Ω —É—Å–ø–µ—à–Ω–æ",
                    grossROI: "–í–∞–ª–æ–≤–∞—è –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å",
                    netROI: "–ß–∏—Å—Ç–∞—è –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å",
                    yearlyGrossIncome: "–ì–æ–¥–æ–≤–æ–π –¥–æ—Ö–æ–¥ (–≤–∞–ª–æ–≤–æ–π)",
                    yearlyNetIncome: "–ì–æ–¥–æ–≤–æ–π –¥–æ—Ö–æ–¥ (—á–∏—Å—Ç—ã–π)",
                    monthlyNetIncome: "–ï–∂–µ–º–µ—Å—è—á–Ω—ã–π —á–∏—Å—Ç—ã–π –¥–æ—Ö–æ–¥",
                    paybackPeriod: "–°—Ä–æ–∫ –æ–∫—É–ø–∞–µ–º–æ—Å—Ç–∏",
                    monthlyExpenses: "–†–∞—Å—Ö–æ–¥—ã –≤ –º–µ—Å—è—Ü",
                    management: "–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ",
                    repair: "–†–µ–º–æ–Ω—Ç",
                    taxes: "–ù–∞–ª–æ–≥–∏",
                    insurance: "–°—Ç—Ä–∞—Ö–æ–≤–∫–∞",
                    totalExpenses: "–ò—Ç–æ–≥–æ —Ä–∞—Å—Ö–æ–¥–æ–≤",
                    perMonth: "/ –º–µ—Å—è—Ü",
                    addToComparison: "‚ûï –î–æ–±–∞–≤–∏—Ç—å –≤ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ",
                    impossible: "–ù–µ–≤–æ–∑–º–æ–∂–Ω–æ",
                    years: "–ª–µ—Ç"
                },
                history: {
                    title: "üìö –ò—Å—Ç–æ—Ä–∏—è —Ä–∞—Å—á—ë—Ç–æ–≤",
                    noData: "–†–∞—Å—á—ë—Ç—ã –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å"
                },
                comparison: {
                    title: "üîÄ –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤",
                    noData: "–°–æ—Ö—Ä–∞–Ω–∏ –º–∏–Ω–∏–º—É–º 2 —Ä–∞—Å—á—ë—Ç–∞ –∏–∑ –∏—Å—Ç–æ—Ä–∏–∏ –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è",
                    clear: "üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ",
                    rent: "–ê—Ä–µ–Ω–¥–∞",
                    expenses: "–†–∞—Å—Ö–æ–¥—ã",
                    netIncome: "–ß–∏—Å—Ç—ã–π –¥–æ—Ö–æ–¥",
                    payback: "–û–∫—É–ø–∞–µ–º–æ—Å—Ç—å",
                    remove: "–£–¥–∞–ª–∏—Ç—å",
                    added: "‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –≤ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ",
                    alreadyAdded: "‚ÑπÔ∏è –≠—Ç–æ—Ç —Ä–∞—Å—á—ë—Ç —É–∂–µ –≤ —Å—Ä–∞–≤–Ω–µ–Ω–∏–∏",
                    notFound: "‚ö†Ô∏è –†–∞—Å—á—ë—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –∏—Å—Ç–æ—Ä–∏–∏"
                },
                blog: {
                    title: "üìö –ö–∞–∫ —Ä–∞—Å—Å—á–∏—Ç–∞—Ç—å –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å –∞—Ä–µ–Ω–¥—ã –∫–≤–∞—Ä—Ç–∏—Ä—ã?",
                    formulaTitle: "–§–æ—Ä–º—É–ª–∞ —Ä–∞—Å—á–µ—Ç–∞ ROI –ø—Ä–∏ –∞—Ä–µ–Ω–¥–µ:",
                    formula: "(–ß–∏—Å—Ç—ã–π –¥–æ—Ö–æ–¥ –≤ –≥–æ–¥ / –°—Ç–æ–∏–º–æ—Å—Ç—å –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏) √ó 100%",
                    exampleTitle: "–ü—Ä–∏–º–µ—Ä —Ä–∞—Å—á–µ—Ç–∞:",
                    example: "–ï—Å–ª–∏ –∫–≤–∞—Ä—Ç–∏—Ä–∞ —Å—Ç–æ–∏—Ç 1,500,000 ‚ÇΩ –∏ –ø—Ä–∏–Ω–æ—Å–∏—Ç 100,000 ‚ÇΩ —á–∏—Å—Ç–æ–≥–æ –¥–æ—Ö–æ–¥–∞ –≤ –≥–æ–¥, —Ç–æ: ROI = (100,000 / 1,500,000) √ó 100% = 6.67%",
                    conclusion: "‚úÖ –≠—Ç–æ —Å—á–∏—Ç–∞–µ—Ç—Å—è —Ö–æ—Ä–æ—à–µ–π –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å—é!",
                    average: "–°—Ä–µ–¥–Ω—è—è –ø–æ –†–æ—Å—Å–∏–∏ 4-8%."
                },
                feedback: {
                    title: "üí¨ –û–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å",
                    namePlaceholder: "–í–∞—à–µ –∏–º—è",
                    emailPlaceholder: "–í–∞—à email",
                    messagePlaceholder: "–í–∞—à–µ —Å–æ–æ–±—â–µ–Ω–∏–µ",
                    submit: "–û—Ç–ø—Ä–∞–≤–∏—Ç—å"
                },
                footer: {
                    text: "RentCalc ¬© 2025 | –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏ –∞—Ä–µ–Ω–¥—ã | –í—Å–µ —Ä–∞—Å—á—ë—Ç—ã –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –≤ –±—Ä–∞—É–∑–µ—Ä–µ, –¥–∞–Ω–Ω—ã–µ –Ω–µ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è"
                },
                errors: {
                    invalidInput: "‚ö†Ô∏è –£–∫–∞–∂–∏ —Ü–µ–Ω—É –∏ –∞—Ä–µ–Ω–¥—É (–æ–±–∞ –ø–æ–ª—è > 0)"
                },
                mode: {
                    basic: "–ë–∞–∑–æ–≤—ã–π",
                    pro: "Pro"
                },
                mortgage: {
                    title: "üè¶ –ò–ø–æ—Ç–µ–∫–∞",
                    useMortgage: "–ò—Å–ø–æ–ª—å–∑—É—é –∏–ø–æ—Ç–µ–∫—É",
                    downPayment: "–ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω—ã–π –≤–∑–Ω–æ—Å",
                    downPaymentTooltip: "–°—É–º–º–∞ –ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–æ–≥–æ –≤–∑–Ω–æ—Å–∞ –≤ —Ä—É–±–ª—è—Ö",
                    interestRate: "–ü—Ä–æ—Ü–µ–Ω—Ç–Ω–∞—è —Å—Ç–∞–≤–∫–∞, –≥–æ–¥–æ–≤–∞—è",
                    interestRateTooltip: "–ì–æ–¥–æ–≤–∞—è –ø—Ä–æ—Ü–µ–Ω—Ç–Ω–∞—è —Å—Ç–∞–≤–∫–∞ –ø–æ –∏–ø–æ—Ç–µ–∫–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, 10%)",
                    loanTerm: "–°—Ä–æ–∫ –∫—Ä–µ–¥–∏—Ç–∞",
                    loanTermTooltip: "–°—Ä–æ–∫ –∫—Ä–µ–¥–∏—Ç–∞ –≤ –≥–æ–¥–∞—Ö",
                    monthlyPayment: "–ú–µ—Å—è—á–Ω—ã–π –ø–ª–∞—Ç—ë–∂ –ø–æ –∏–ø–æ—Ç–µ–∫–µ",
                    monthlyPaymentTooltip: "–ê–Ω–Ω—É–∏—Ç–µ—Ç–Ω—ã–π –ø–ª–∞—Ç—ë–∂ –ø–æ –∏–ø–æ—Ç–µ–∫–µ"
                },
                advanced: {
                    title: "üìä –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ –º–µ—Ç—Ä–∏–∫–∏",
                    resultsTitle: "üìà –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ –º–µ—Ç—Ä–∏–∫–∏",
                    investmentHorizon: "–ì–æ—Ä–∏–∑–æ–Ω—Ç –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–π",
                    investmentHorizonTooltip: "–ü–µ—Ä–∏–æ–¥ –¥–ª—è —Ä–∞—Å—á—ë—Ç–∞ NPV –≤ –≥–æ–¥–∞—Ö",
                    discountRate: "–°—Ç–∞–≤–∫–∞ –¥–∏—Å–∫–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è",
                    discountRateTooltip: "–°—Ç–∞–≤–∫–∞ –¥–∏—Å–∫–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è —Ä–∞—Å—á—ë—Ç–∞ NPV (–Ω–∞–ø—Ä–∏–º–µ—Ä, 10%)",
                    monthlyNetIncomeAfterMortgage: "–ú–µ—Å—è—á–Ω—ã–π —á–∏—Å—Ç—ã–π –¥–æ—Ö–æ–¥ –ø–æ—Å–ª–µ –∏–ø–æ—Ç–µ–∫–∏",
                    yearlyCashFlow: "–ì–æ–¥–æ–≤–æ–π cash flow",
                    cashOnCashReturn: "Cash-on-cash return",
                    npv: "NPV (—á–∏—Å—Ç–∞—è –ø—Ä–∏–≤–µ–¥—ë–Ω–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å)",
                    npvTooltip: "–ß–∏—Å—Ç–∞—è –ø—Ä–∏–≤–µ–¥—ë–Ω–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏"
                }
            },
            en: {
                app: {
                    title: "RentCalc",
                    subtitle: "Rental Yield Calculator"
                },
                form: {
                    title: "üìä Calculation Parameters",
                    propertyPrice: "Property Purchase Price",
                    propertyPriceTooltip: "Full cost of the apartment when purchasing",
                    monthlyRent: "Monthly Rent",
                    monthlyRentTooltip: "Amount you receive from the tenant",
                    managementCost: "Building Management (per month)",
                    managementCostTooltip: "Building maintenance fee, elevator, security",
                    repairCost: "Repairs and Maintenance (per month)",
                    repairCostTooltip: "Preventive repairs, furniture replacement",
                    taxesCost: "Taxes (per month)",
                    taxesCostTooltip: "Income tax and other taxes",
                    insuranceCost: "Insurance (per month)",
                    insuranceCostTooltip: "Property insurance against risks",
                    utilitiesCost: "Utilities (per month)",
                    utilitiesCostTooltip: "If you pay instead of the tenant",
                    calculate: "üí∞ Calculate",
                    clear: "üîÑ Clear",
                    hint: "üí° Tip: press Enter or click \"Calculate\""
                },
                results: {
                    title: "üìà Results",
                    noData: "Enter parameters and click \"Calculate\"",
                    success: "‚úÖ Calculation completed successfully",
                    grossROI: "Gross Yield",
                    netROI: "Net Yield",
                    yearlyGrossIncome: "Annual Income (Gross)",
                    yearlyNetIncome: "Annual Income (Net)",
                    monthlyNetIncome: "Monthly Net Income",
                    paybackPeriod: "Payback Period",
                    monthlyExpenses: "Monthly Expenses",
                    management: "Management",
                    repair: "Repairs",
                    taxes: "Taxes",
                    insurance: "Insurance",
                    totalExpenses: "Total Expenses",
                    perMonth: "/ month",
                    addToComparison: "‚ûï Add to Comparison",
                    impossible: "Impossible",
                    years: "years"
                },
                history: {
                    title: "üìö Calculation History",
                    noData: "Calculations will appear here"
                },
                comparison: {
                    title: "üîÄ Compare Options",
                    noData: "Save at least 2 calculations from history to compare",
                    clear: "üóëÔ∏è Clear Comparison",
                    rent: "Rent",
                    expenses: "Expenses",
                    netIncome: "Net Income",
                    payback: "Payback",
                    remove: "Remove",
                    added: "‚úÖ Added to comparison",
                    alreadyAdded: "‚ÑπÔ∏è This calculation is already in comparison",
                    notFound: "‚ö†Ô∏è Calculation not found in history"
                },
                blog: {
                    title: "üìö How to Calculate Rental Yield?",
                    formulaTitle: "ROI Calculation Formula for Rent:",
                    formula: "(Net Annual Income / Property Value) √ó 100%",
                    exampleTitle: "Calculation Example:",
                    example: "If a property costs 1,500,000 ‚ÇΩ and generates 100,000 ‚ÇΩ net income per year, then: ROI = (100,000 / 1,500,000) √ó 100% = 6.67%",
                    conclusion: "‚úÖ This is considered good yield!",
                    average: "Average in Russia is 4-8%."
                },
                feedback: {
                    title: "üí¨ Feedback",
                    namePlaceholder: "Your Name",
                    emailPlaceholder: "Your Email",
                    messagePlaceholder: "Your Message",
                    submit: "Send"
                },
                footer: {
                    text: "RentCalc ¬© 2025 | Rental Yield Calculator | All calculations are performed in the browser, data is not transmitted"
                },
                errors: {
                    invalidInput: "‚ö†Ô∏è Enter price and rent (both fields > 0)"
                },
                mode: {
                    basic: "Basic",
                    pro: "Pro"
                },
                mortgage: {
                    title: "üè¶ Mortgage",
                    useMortgage: "Using mortgage",
                    downPayment: "Down payment",
                    downPaymentTooltip: "Down payment amount in rubles",
                    interestRate: "Interest rate, annual",
                    interestRateTooltip: "Annual mortgage interest rate (e.g., 10%)",
                    loanTerm: "Loan term",
                    loanTermTooltip: "Loan term in years",
                    monthlyPayment: "Monthly mortgage payment",
                    monthlyPaymentTooltip: "Annuity mortgage payment"
                },
                advanced: {
                    title: "üìä Advanced Metrics",
                    resultsTitle: "üìà Advanced Metrics",
                    investmentHorizon: "Investment horizon",
                    investmentHorizonTooltip: "Period for NPV calculation in years",
                    discountRate: "Discount rate",
                    discountRateTooltip: "Discount rate for NPV calculation (e.g., 10%)",
                    monthlyNetIncomeAfterMortgage: "Monthly net income after mortgage",
                    yearlyCashFlow: "Annual cash flow",
                    cashOnCashReturn: "Cash-on-cash return",
                    npv: "NPV (Net Present Value)",
                    npvTooltip: "Net present value of investment"
                }
            }
        };

        // === LANGUAGE MANAGEMENT ===
        let currentLanguage = 'ru';

        function getTranslation(key) {
            const keys = key.split('.');
            let value = translations[currentLanguage];
            for (const k of keys) {
                value = value?.[k];
            }
            return value || key;
        }

        function changeLanguage(lang) {
            currentLanguage = lang;
            try {
                localStorage.setItem('rentcalc_language', lang);
            } catch (e) {
                console.warn('Failed to save language to localStorage:', e);
            }
            document.documentElement.setAttribute('lang', lang);
            updatePageTranslations();
            updateMetaTags();
        }

        function updatePageTranslations() {
            // Update all elements with data-i18n attribute
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                const translation = getTranslation(key);
                if (el.tagName === 'INPUT' || el.tagName === 'TEXTAREA') {
                    // For inputs, update placeholder
                    if (el.hasAttribute('data-placeholder-i18n')) {
                        el.placeholder = getTranslation(el.getAttribute('data-placeholder-i18n'));
                    }
                } else {
                    el.textContent = translation;
                }
            });

            // Update placeholders separately
            document.querySelectorAll('[data-placeholder-i18n]').forEach(el => {
                const key = el.getAttribute('data-placeholder-i18n');
                el.placeholder = getTranslation(key);
            });

            // Update language buttons
            document.querySelectorAll('.lang-button').forEach(btn => {
                btn.classList.remove('active');
            });
            const activeBtn = document.getElementById(`lang-${currentLanguage}`);
            if (activeBtn) {
                activeBtn.classList.add('active');
            }

            // Re-render dynamic content
            if (calculations.length > 0) {
                displayHistory();
            }
            if (comparisonItems.length > 0) {
                displayComparison();
            }
            // Re-render results if they exist
            const resultsContainer = document.getElementById('results-container');
            if (resultsContainer && resultsContainer.querySelector('.result-item')) {
                const lastCalc = calculations[0];
                if (lastCalc) {
                    displayResults(lastCalc);
                }
            }
        }

        function updateMetaTags() {
            const t = translations[currentLanguage];
            document.title = `${t.app.title} - ${t.app.subtitle}`;
            document.querySelector('meta[name="description"]').content = t.app.subtitle + '. ' + (currentLanguage === 'ru' 
                ? '–†–∞—Å—Å—á–∏—Ç–∞–π—Ç–µ –≤–∞–ª–æ–≤—É—é –∏ —á–∏—Å—Ç—É—é –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å –∫–≤–∞—Ä—Ç–∏—Ä—ã –∑–∞ 30 —Å–µ–∫—É–Ω–¥. –°—Ä–∞–≤–Ω–∏–≤–∞–π—Ç–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–π.'
                : 'Calculate gross and net rental yield in 30 seconds. Compare investment options.');
            document.querySelector('meta[property="og:title"]').content = `${t.app.title} - ${t.app.subtitle}`;
            document.querySelector('meta[property="og:description"]').content = currentLanguage === 'ru'
                ? '–†–∞—Å—Å—á–∏—Ç–∞–π—Ç–µ ROI –∞—Ä–µ–Ω–¥—ã –∫–≤–∞—Ä—Ç–∏—Ä—ã –∑–∞ 30 —Å–µ–∫—É–Ω–¥'
                : 'Calculate rental ROI in 30 seconds';
        }

        // Initialize language (will be set properly in DOMContentLoaded)
        try {
            const savedLang = localStorage.getItem('rentcalc_language') || 
                            (navigator.language.startsWith('ru') ? 'ru' : 'en');
            currentLanguage = savedLang;
        } catch (e) {
            console.warn('Failed to load language from localStorage:', e);
            currentLanguage = 'ru';
        }

        // === THEME TOGGLE ===
        function toggleTheme() {
            const html = document.documentElement;
            const isDark = html.getAttribute('data-theme') === 'dark';
            const newTheme = isDark ? 'light' : 'dark';
            html.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            updateThemeIcon(newTheme);
        }

        function updateThemeIcon(theme) {
            const icon = document.getElementById('theme-icon');
            icon.textContent = theme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
        }

        // Load saved theme
        const savedTheme = localStorage.getItem('theme') || 'light';
        document.documentElement.setAttribute('data-theme', savedTheme);
        updateThemeIcon(savedTheme);

        // === MODE MANAGEMENT ===
        let currentMode = 'basic'; // 'basic' or 'pro'

        function toggleMode(mode) {
            currentMode = mode;
            try {
                localStorage.setItem('rentcalc_mode', mode);
            } catch (e) {
                console.warn('Failed to save mode to localStorage:', e);
            }
            
            // Update mode buttons
            document.querySelectorAll('.mode-button').forEach(btn => {
                btn.classList.remove('active');
            });
            const modeButton = document.getElementById(`mode-${mode}`);
            if (modeButton) {
                modeButton.classList.add('active');
            }
            
            // Show/hide Pro sections
            const proSections = document.querySelectorAll('.pro-section');
            proSections.forEach(section => {
                if (mode === 'pro') {
                    section.classList.add('active');
                } else {
                    section.classList.remove('active');
                }
            });
            
            // Hide/show mortgage fields based on checkbox
            if (mode === 'pro') {
                toggleMortgageFields();
            } else {
                const mortgageFields = document.getElementById('mortgage-fields');
                if (mortgageFields) {
                    mortgageFields.style.display = 'none';
                }
            }
            
            // Hide advanced results in basic mode
            if (mode === 'basic') {
                const advancedResults = document.getElementById('advanced-results-container');
                if (advancedResults) {
                    advancedResults.style.display = 'none';
                }
            } else {
                // If in Pro mode and there are results, recalculate if mortgage is enabled
                const resultsContainer = document.getElementById('results-container');
                if (resultsContainer && resultsContainer.querySelector('.result-item')) {
                    // Trigger recalculation if there are existing results
                    const useMortgage = document.getElementById('useMortgage')?.checked;
                    if (useMortgage) {
                        // Results will be recalculated on next calculate() call
                    }
                }
            }
        }

        function toggleMortgageFields() {
            const checkbox = document.getElementById('useMortgage');
            const fields = document.getElementById('mortgage-fields');
            if (checkbox && fields) {
                fields.style.display = checkbox.checked ? 'block' : 'none';
            }
        }

        // Load saved mode
        try {
            const savedMode = localStorage.getItem('rentcalc_mode') || 'basic';
            currentMode = savedMode;
        } catch (e) {
            console.warn('Failed to load mode from localStorage:', e);
            currentMode = 'basic';
        }

        // === CALCULATION LOGIC ===
        let calculations = [];
        let comparisonItems = [];

        // Format number with spaces (e.g., 1500000 -> "1 500 000")
        function formatMoney(value) {
            if (!value && value !== 0) return '';
            // Remove all non-digit characters
            const numStr = String(value).replace(/\D/g, '');
            if (!numStr) return '';
            // Add spaces every 3 digits from right
            return numStr.replace(/\B(?=(\d{3})+(?!\d))/g, ' ');
        }

        // Parse formatted money string to number (e.g., "1 500 000" -> 1500000)
        function parseMoney(value) {
            if (!value) return 0;
            // Remove all non-digit characters and parse
            const numStr = String(value).replace(/\D/g, '');
            return parseFloat(numStr) || 0;
        }

        // Format input on change
        function formatMoneyInput(input) {
            const cursorPos = input.selectionStart;
            const oldValue = input.value;
            const oldLength = oldValue.length;
            
            const parsed = parseMoney(oldValue);
            const formatted = formatMoney(parsed);
            
            input.value = formatted;
            
            // Adjust cursor position
            const newLength = formatted.length;
            const lengthDiff = newLength - oldLength;
            const newCursorPos = Math.max(0, cursorPos + lengthDiff);
            input.setSelectionRange(newCursorPos, newCursorPos);
        }

        function getFormValues() {
            const values = {
                propertyPrice: parseMoney(document.getElementById('propertyPrice').value),
                monthlyRent: parseMoney(document.getElementById('monthlyRent').value),
                managementCost: parseMoney(document.getElementById('managementCost').value),
                repairCost: parseMoney(document.getElementById('repairCost').value),
                taxesCost: parseMoney(document.getElementById('taxesCost').value),
                insuranceCost: parseMoney(document.getElementById('insuranceCost').value),
                utilitiesCost: parseMoney(document.getElementById('utilitiesCost').value),
            };
            
            // Pro mode: mortgage values
            if (currentMode === 'pro') {
                values.useMortgage = document.getElementById('useMortgage')?.checked || false;
                values.downPayment = parseMoney(document.getElementById('downPayment')?.value || '0');
                values.interestRate = parseFloat(document.getElementById('interestRate')?.value || '0');
                values.loanTerm = parseFloat(document.getElementById('loanTerm')?.value || '0');
                values.investmentHorizon = parseFloat(document.getElementById('investmentHorizon')?.value || '10');
                values.discountRate = parseFloat(document.getElementById('discountRate')?.value || '10');
            }
            
            return values;
        }

        // === MORTGAGE CALCULATIONS ===
        /**
         * Calculate monthly mortgage payment using annuity formula
         * M = L * (i * (1 + i)^n) / ((1 + i)^n - 1)
         * where:
         * L = loan amount (propertyPrice - downPayment)
         * i = monthly interest rate (annualRate / 12 / 100)
         * n = number of months (loanTerm * 12)
         */
        function calculateMortgagePayment(loanAmount, annualRate, loanTermYears) {
            if (loanAmount <= 0 || annualRate <= 0 || loanTermYears <= 0) {
                return 0;
            }
            
            const monthlyRate = annualRate / 12 / 100; // Convert to decimal
            const numMonths = loanTermYears * 12;
            
            if (monthlyRate === 0) {
                // No interest, just divide loan by months
                return loanAmount / numMonths;
            }
            
            const numerator = monthlyRate * Math.pow(1 + monthlyRate, numMonths);
            const denominator = Math.pow(1 + monthlyRate, numMonths) - 1;
            
            return loanAmount * (numerator / denominator);
        }

        /**
         * Calculate cash-on-cash return
         * cashOnCash = (yearlyCashFlow / initialCash) * 100
         */
        function calculateCashOnCash(yearlyCashFlow, initialCash) {
            if (initialCash <= 0) return 0;
            return (yearlyCashFlow / initialCash) * 100;
        }

        /**
         * Calculate NPV (Net Present Value)
         * NPV = -initialCash + sum_{t=1..T}(CFt / (1 + k)^t) + TerminalValue / (1 + k)^T
         * where:
         * initialCash = downPayment
         * CFt = yearlyCashFlow (constant for each year)
         * k = discount rate (as decimal)
         * T = investment horizon
         * TerminalValue = propertyPrice (current value, no growth)
         */
        function calculateNPV(initialCash, yearlyCashFlow, discountRate, investmentHorizon, terminalValue) {
            if (investmentHorizon <= 0) return 0;
            
            const k = discountRate / 100; // Convert to decimal
            let npv = -initialCash; // Initial investment (negative cash flow)
            
            // Sum of discounted cash flows for each year
            for (let t = 1; t <= investmentHorizon; t++) {
                npv += yearlyCashFlow / Math.pow(1 + k, t);
            }
            
            // Add terminal value (property value at end of horizon)
            if (terminalValue > 0) {
                npv += terminalValue / Math.pow(1 + k, investmentHorizon);
            }
            
            return npv;
        }

        function calculate() {
            const values = getFormValues();
            
            if (values.propertyPrice <= 0 || values.monthlyRent <= 0) {
                alert(getTranslation('errors.invalidInput'));
                return null;
            }

            const totalMonthlyExpenses = 
                values.managementCost + 
                values.repairCost + 
                values.taxesCost + 
                values.insuranceCost + 
                values.utilitiesCost;

            const monthlyNetIncome = values.monthlyRent - totalMonthlyExpenses;
            const yearlyGrossIncome = values.monthlyRent * 12;
            const yearlyNetIncome = monthlyNetIncome * 12;
            const yearlyExpenses = totalMonthlyExpenses * 12;

            const grossROI = (yearlyGrossIncome / values.propertyPrice) * 100;
            const netROI = (yearlyNetIncome / values.propertyPrice) * 100;
            const paybackPeriod = yearlyNetIncome > 0 ? values.propertyPrice / yearlyNetIncome : Infinity;

            const result = {
                ...values,
                totalMonthlyExpenses,
                monthlyNetIncome,
                yearlyGrossIncome,
                yearlyNetIncome,
                yearlyExpenses,
                grossROI,
                netROI,
                paybackPeriod,
                timestamp: new Date().toLocaleString(currentLanguage === 'ru' ? 'ru-RU' : 'en-US'),
                id: Date.now()
            };

            // Pro mode: Calculate mortgage and advanced metrics
            if (currentMode === 'pro' && values.useMortgage) {
                const loanAmount = values.propertyPrice - values.downPayment;
                const monthlyMortgagePayment = calculateMortgagePayment(
                    loanAmount,
                    values.interestRate,
                    values.loanTerm
                );
                
                const monthlyNetIncomeAfterMortgage = monthlyNetIncome - monthlyMortgagePayment;
                const yearlyCashFlow = monthlyNetIncomeAfterMortgage * 12;
                const cashOnCash = calculateCashOnCash(yearlyCashFlow, values.downPayment);
                
                // NPV calculation
                const npv = calculateNPV(
                    values.downPayment,
                    yearlyCashFlow,
                    values.discountRate,
                    values.investmentHorizon,
                    values.propertyPrice // Terminal value (current price, no growth)
                );
                
                // Add Pro metrics to result
                result.monthlyMortgagePayment = monthlyMortgagePayment;
                result.loanAmount = loanAmount;
                result.monthlyNetIncomeAfterMortgage = monthlyNetIncomeAfterMortgage;
                result.yearlyCashFlow = yearlyCashFlow;
                result.cashOnCash = cashOnCash;
                result.npv = npv;
            }

            return result;
        }

        function displayResults(calc) {
            if (!calc) return;

            const locale = currentLanguage === 'ru' ? 'ru-RU' : 'en-US';
            const t = translations[currentLanguage].results;
            const tMortgage = translations[currentLanguage].mortgage;
            const tAdvanced = translations[currentLanguage].advanced;

            // Base results (always shown)
            let resultsHTML = `
                <div class="alert alert-success">
                    ${t.success}
                </div>

                <div class="results-grid">
                    <div class="result-item">
                        <div class="result-label">${t.grossROI}</div>
                        <div class="result-value">${calc.grossROI.toFixed(2)}%</div>
                    </div>
                    <div class="result-item">
                        <div class="result-label">${t.netROI}</div>
                        <div class="result-value ${calc.netROI < 0 ? 'error' : 'info'}">${calc.netROI.toFixed(2)}%</div>
                    </div>
                    <div class="result-item">
                        <div class="result-label">${t.yearlyGrossIncome}</div>
                        <div class="result-value" style="color: var(--warning);">${Math.round(calc.yearlyGrossIncome).toLocaleString(locale)} ‚ÇΩ</div>
                    </div>
                    <div class="result-item">
                        <div class="result-label">${t.yearlyNetIncome}</div>
                        <div class="result-value ${calc.yearlyNetIncome < 0 ? 'error' : ''}">${Math.round(calc.yearlyNetIncome).toLocaleString(locale)} ‚ÇΩ</div>
                    </div>
                    <div class="result-item">
                        <div class="result-label">${t.monthlyNetIncome}</div>
                        <div class="result-value ${calc.monthlyNetIncome < 0 ? 'error' : ''}">${Math.round(calc.monthlyNetIncome).toLocaleString(locale)} ‚ÇΩ</div>
                    </div>
                    <div class="result-item">
                        <div class="result-label">${t.paybackPeriod}</div>
                        <div class="result-value ${calc.paybackPeriod === Infinity || calc.paybackPeriod < 0 ? 'error' : calc.paybackPeriod > 30 ? 'warning' : 'info'}">${calc.paybackPeriod === Infinity ? '‚àû' : calc.paybackPeriod < 0 ? t.impossible : calc.paybackPeriod.toFixed(1) + ' ' + t.years}</div>
                    </div>
                </div>

                <div style="margin-top: 20px; padding: 16px; background: rgba(16, 185, 129, 0.05); border-radius: 8px;">
                    <p style="font-size: 0.9rem; margin-bottom: 8px;"><strong>üìä ${t.monthlyExpenses}:</strong></p>
                    <div style="font-size: 0.85rem; color: var(--text-light); line-height: 1.8;">
                        ${t.management}: ${Math.round(calc.managementCost).toLocaleString(locale)} ‚ÇΩ | 
                        ${t.repair}: ${Math.round(calc.repairCost).toLocaleString(locale)} ‚ÇΩ | 
                        ${t.taxes}: ${Math.round(calc.taxesCost).toLocaleString(locale)} ‚ÇΩ | 
                        ${t.insurance}: ${Math.round(calc.insuranceCost).toLocaleString(locale)} ‚ÇΩ
                    </div>
                    <div style="font-size: 0.85rem; color: var(--text-light); margin-top: 8px;">
                        <strong>${t.totalExpenses}:</strong> ${Math.round(calc.totalMonthlyExpenses).toLocaleString(locale)} ‚ÇΩ ${t.perMonth}
                    </div>
                </div>

                <div style="margin-top: 16px;">
                    <button class="btn-secondary" onclick="addToComparison(${calc.id})" style="width: 100%;">${t.addToComparison}</button>
                </div>
            `;

            document.getElementById('results-container').innerHTML = resultsHTML;

            // Pro mode: Display advanced metrics
            if (currentMode === 'pro' && calc.useMortgage && calc.monthlyMortgagePayment !== undefined) {
                const advancedResultsHTML = `
                    <div class="results-grid">
                        <div class="result-item">
                            <div class="result-label">${tMortgage.monthlyPayment}</div>
                            <div class="result-value" style="color: var(--secondary);">${Math.round(calc.monthlyMortgagePayment).toLocaleString(locale)} ‚ÇΩ</div>
                        </div>
                        <div class="result-item">
                            <div class="result-label">${tAdvanced.monthlyNetIncomeAfterMortgage}</div>
                            <div class="result-value ${calc.monthlyNetIncomeAfterMortgage < 0 ? 'error' : ''}">${Math.round(calc.monthlyNetIncomeAfterMortgage).toLocaleString(locale)} ‚ÇΩ</div>
                        </div>
                        <div class="result-item">
                            <div class="result-label">${tAdvanced.yearlyCashFlow}</div>
                            <div class="result-value ${calc.yearlyCashFlow < 0 ? 'error' : ''}">${Math.round(calc.yearlyCashFlow).toLocaleString(locale)} ‚ÇΩ</div>
                        </div>
                        <div class="result-item">
                            <div class="result-label">${tAdvanced.cashOnCashReturn}</div>
                            <div class="result-value ${calc.cashOnCash < 0 ? 'error' : ''}">${calc.cashOnCash.toFixed(2)}%</div>
                        </div>
                        <div class="result-item" style="grid-column: 1 / -1;">
                            <div class="result-label">${tAdvanced.npv}</div>
                            <div class="result-value ${calc.npv < 0 ? 'error' : 'success'}" style="font-size: 2rem;">${Math.round(calc.npv).toLocaleString(locale)} ‚ÇΩ</div>
                        </div>
                    </div>
                `;

                const advancedContainer = document.getElementById('advanced-results-container');
                const advancedContent = document.getElementById('advanced-results-content');
                if (advancedContainer && advancedContent) {
                    advancedContent.innerHTML = advancedResultsHTML;
                    advancedContainer.style.display = 'block';
                }
            } else {
                // Hide advanced results if not in Pro mode or mortgage not used
                const advancedContainer = document.getElementById('advanced-results-container');
                if (advancedContainer) {
                    advancedContainer.style.display = 'none';
                }
            }
        }

        function calculateOnButtonClick() {
            const calc = calculate();
            if (calc) {
                displayResults(calc);
                addToHistory(calc);
            }
        }

        // === HISTORY MANAGEMENT ===
        function addToHistory(calc) {
            calculations.unshift(calc);
            if (calculations.length > 20) calculations.pop();
            try {
                localStorage.setItem('rentcalc_history', JSON.stringify(calculations));
            } catch (e) {
                console.warn('Failed to save history to localStorage:', e);
            }
            displayHistory();
        }

        function displayHistory() {
            if (calculations.length === 0) {
                const t = getTranslation('history.noData');
                document.getElementById('history-container').innerHTML = 
                    `<div class="no-data" style="padding: 16px;">${t}</div>`;
                return;
            }

            const locale = currentLanguage === 'ru' ? 'ru-RU' : 'en-US';
            const monthText = currentLanguage === 'ru' ? '/–º–µ—Å' : '/mo';

            const historyHTML = calculations.map(calc => `
                <div class="history-item" onclick="loadFromHistory(${calc.id})">
                    <div class="history-item-text">
                        üè† ${Math.round(calc.propertyPrice/1000000)}M ‚ÇΩ | üí∞ ${Math.round(calc.monthlyRent)}‚ÇΩ${monthText} | ${calc.netROI.toFixed(1)}% ROI
                        <br><small style="opacity: 0.7;">${calc.timestamp}</small>
                    </div>
                    <button class="history-delete" onclick="deleteFromHistory(${calc.id}, event)">‚úï</button>
                </div>
            `).join('');

            document.getElementById('history-container').innerHTML = historyHTML;
        }

        function loadFromHistory(id) {
            const calc = calculations.find(c => c.id === id);
            if (calc) {
                document.getElementById('propertyPrice').value = formatMoney(calc.propertyPrice);
                document.getElementById('monthlyRent').value = formatMoney(calc.monthlyRent);
                document.getElementById('managementCost').value = formatMoney(calc.managementCost);
                document.getElementById('repairCost').value = formatMoney(calc.repairCost);
                document.getElementById('taxesCost').value = formatMoney(calc.taxesCost);
                document.getElementById('insuranceCost').value = formatMoney(calc.insuranceCost);
                document.getElementById('utilitiesCost').value = formatMoney(calc.utilitiesCost);
                
                // Load Pro mode values if they exist
                if (calc.useMortgage !== undefined && currentMode === 'pro') {
                    document.getElementById('useMortgage').checked = calc.useMortgage;
                    if (calc.downPayment !== undefined) {
                        document.getElementById('downPayment').value = formatMoney(calc.downPayment);
                    }
                    if (calc.interestRate !== undefined) {
                        document.getElementById('interestRate').value = calc.interestRate;
                    }
                    if (calc.loanTerm !== undefined) {
                        document.getElementById('loanTerm').value = calc.loanTerm;
                    }
                    if (calc.investmentHorizon !== undefined) {
                        document.getElementById('investmentHorizon').value = calc.investmentHorizon;
                    }
                    if (calc.discountRate !== undefined) {
                        document.getElementById('discountRate').value = calc.discountRate;
                    }
                    toggleMortgageFields();
                }
                
                displayResults(calc);
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        }

        function deleteFromHistory(id, event) {
            event.stopPropagation();
            calculations = calculations.filter(c => c.id !== id);
            // Also remove from comparison if it's there
            comparisonItems = comparisonItems.filter(c => c.id !== id);
            try {
                localStorage.setItem('rentcalc_history', JSON.stringify(calculations));
                localStorage.setItem('rentcalc_comparison', JSON.stringify(comparisonItems));
            } catch (e) {
                console.warn('Failed to save to localStorage:', e);
            }
            displayHistory();
            displayComparison();
        }

        function clearForm() {
            document.getElementById('propertyPrice').value = '1 500 000';
            document.getElementById('monthlyRent').value = '30 000';
            document.getElementById('managementCost').value = '3 000';
            document.getElementById('repairCost').value = '2 000';
            document.getElementById('taxesCost').value = '1 500';
            document.getElementById('insuranceCost').value = '500';
            document.getElementById('utilitiesCost').value = '0';
            const t = getTranslation('results.noData');
            document.getElementById('results-container').innerHTML = 
                `<div class="no-data">${t}</div>`;
        }

        // === COMPARISON ===
        function addToComparison(id) {
            const calc = calculations.find(c => c.id === id);
            const t = translations[currentLanguage].comparison;
            if (!calc) {
                alert(t.notFound);
                return;
            }
            if (comparisonItems.find(c => c.id === id)) {
                alert(t.alreadyAdded);
                return;
            }
            comparisonItems.push(calc);
            if (comparisonItems.length > 3) comparisonItems.shift();
            try {
                localStorage.setItem('rentcalc_comparison', JSON.stringify(comparisonItems));
            } catch (e) {
                console.warn('Failed to save comparison to localStorage:', e);
            }
            displayComparison();
            alert(t.added);
        }

        function displayComparison() {
            const t = translations[currentLanguage].comparison;
            const locale = currentLanguage === 'ru' ? 'ru-RU' : 'en-US';
            const monthText = currentLanguage === 'ru' ? '/–º–µ—Å' : '/mo';
            const yearsText = currentLanguage === 'ru' ? '–ª–µ—Ç' : 'years';

            if (comparisonItems.length < 2) {
                document.getElementById('comparison-container').innerHTML = 
                    `<div class="no-data">${t.noData}</div>`;
                return;
            }

            const comparisonHTML = `
                <div class="comparison-grid">
                    ${comparisonItems.map(calc => `
                        <div class="comparison-card">
                            <div class="comparison-title">
                                üè† ${Math.round(calc.propertyPrice/1000000)}M ‚ÇΩ
                            </div>
                            <div style="font-size: 0.9rem; line-height: 1.8;">
                                <p><strong>${t.rent}:</strong> ${Math.round(calc.monthlyRent).toLocaleString(locale)} ‚ÇΩ${monthText}</p>
                                <p><strong>${t.expenses}:</strong> ${Math.round(calc.totalMonthlyExpenses).toLocaleString(locale)} ‚ÇΩ${monthText}</p>
                                <p><strong>${t.netIncome}:</strong> ${Math.round(calc.monthlyNetIncome).toLocaleString(locale)} ‚ÇΩ${monthText}</p>
                                <p style="margin-top: 12px; padding-top: 12px; border-top: 1px solid var(--border);">
                                    <strong style="color: var(--primary);">ROI: ${calc.netROI.toFixed(2)}%</strong>
                                </p>
                                <p style="font-size: 0.85rem; color: var(--text-light);">
                                    ${t.payback}: ${calc.paybackPeriod === Infinity ? '‚àû' : calc.paybackPeriod < 0 ? getTranslation('results.impossible') : calc.paybackPeriod.toFixed(1) + ' ' + yearsText}
                                </p>
                            </div>
                            <button class="btn-secondary" style="width: 100%; margin-top: 12px;" onclick="removeFromComparison(${calc.id})">${t.remove}</button>
                        </div>
                    `).join('')}
                </div>
            `;

            document.getElementById('comparison-container').innerHTML = comparisonHTML;
        }

        function removeFromComparison(id) {
            comparisonItems = comparisonItems.filter(c => c.id !== id);
            try {
                localStorage.setItem('rentcalc_comparison', JSON.stringify(comparisonItems));
            } catch (e) {
                console.warn('Failed to save comparison to localStorage:', e);
            }
            displayComparison();
        }

        function clearComparison() {
            comparisonItems = [];
            try {
                localStorage.removeItem('rentcalc_comparison');
            } catch (e) {
                console.warn('Failed to clear comparison from localStorage:', e);
            }
            displayComparison();
        }

        // === KEYBOARD EVENTS ===
        document.addEventListener('DOMContentLoaded', function() {
            // Setup money formatting for all money inputs
            const moneyInputs = document.querySelectorAll('.money-input');
            moneyInputs.forEach(input => {
                // Format on input
                input.addEventListener('input', function(e) {
                    formatMoneyInput(this);
                });
                
                // Format on blur (when user leaves the field)
                input.addEventListener('blur', function(e) {
                    formatMoneyInput(this);
                });
                
                // Handle Enter key
                input.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        calculateOnButtonClick();
                    }
                });
            });

            // Load saved data
            try {
                const savedHistory = localStorage.getItem('rentcalc_history');
                if (savedHistory) {
                    calculations = JSON.parse(savedHistory);
                    displayHistory();
                }
            } catch (e) {
                console.warn('Failed to load history from localStorage:', e);
            }

            try {
                const savedComparison = localStorage.getItem('rentcalc_comparison');
                if (savedComparison) {
                    comparisonItems = JSON.parse(savedComparison);
                    // Filter out items that are no longer in history
                    comparisonItems = comparisonItems.filter(item => 
                        calculations.some(calc => calc.id === item.id)
                    );
                    displayComparison();
                }
            } catch (e) {
                console.warn('Failed to load comparison from localStorage:', e);
            }

            // Initialize mode
            toggleMode(currentMode);
            
            // Initialize language and translations after page load
            document.documentElement.setAttribute('lang', currentLanguage);
            // Update language buttons
            document.querySelectorAll('.lang-button').forEach(btn => {
                btn.classList.remove('active');
            });
            const activeBtn = document.getElementById(`lang-${currentLanguage}`);
            if (activeBtn) {
                activeBtn.classList.add('active');
            }
            updatePageTranslations();
            updateMetaTags();
        });

        // Analytics helper (optional - remove if not needed)
        function trackEvent(eventName) {
            // Can be replaced with actual analytics later
            console.log('Event:', eventName);
        }
    </script>
</body>
</html>
